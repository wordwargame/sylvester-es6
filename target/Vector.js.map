{"version":3,"sources":["../src/Vector.js"],"names":["Vector","elements","setElements","i","length","Math","sqrt","dot","vector","n","V","abs","PRECISION","fn","context","each","x","push","call","r","modulus","dup","map","k","mod1","mod2","theta","acos","angle","angleFrom","PI","product","B","A","m","index","Matrix","Diagonal","round","y","obj","anchor","start","end","distanceFrom","sum","part","line","contains","plane","t","R","z","determinant","Rotation","direction","C","pointClosestTo","P","slice","Q","join","els","Random","random","Zero","prototype","multiply","forEach","j"],"mappings":"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","file":"Vector.js","sourcesContent":["\"use strict\";\n\nimport { Matrix } from \"./Matrix\";\nimport { PRECISION } from \"./PRECISION\";\n\nexport class Vector\n{\n    constructor (elements)\n    {\n        this.setElements(elements);\n    }\n\n    e (i)\n    {\n        return (i < 1 || i > this.elements.length) ? null : this.elements[i-1];\n    }\n\n    dimensions ()\n    {\n        return this.elements.length;\n    }\n\n    modulus ()\n    {\n        return Math.sqrt(this.dot(this));\n    }\n\n    eql (vector)\n    {\n        var n = this.elements.length;\n        var V = vector.elements || vector;\n        if (n !== V.length)\n        {\n            return false;\n        }\n        while (n--)\n        {\n            if (Math.abs(this.elements[n] - V[n]) > PRECISION)\n            {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    dup () {\n        return new Vector(this.elements);\n    }\n\n    map (fn, context)\n    {\n        var elements = [];\n        this.each(function(x, i)\n            {\n                elements.push(fn.call(context, x, i));\n            });\n        return new Vector(elements);\n    }\n\n    forEach (fn, context)\n    {\n        var n = this.elements.length;\n        for (var i = 0; i < n; i++)\n        {\n            fn.call(context, this.elements[i], i+1);\n        }\n    }\n\n    toUnitVector ()\n    {\n        var r = this.modulus();\n        if (r === 0)\n        {\n            return this.dup();\n        }\n        return this.map(function(x)\n            {\n                return x/r;\n            });\n    }\n\n    angleFrom (vector)\n    {\n        var V = vector.elements || vector;\n        var n = this.elements.length, k = n, i;\n        if (n !== V.length)\n        {\n            return null;\n        }\n        var dot = 0, mod1 = 0, mod2 = 0;\n        // Work things out in parallel to save time\n        this.each(function(x, i)\n            {\n                dot += x * V[i-1];\n                mod1 += x * x;\n                mod2 += V[i-1] * V[i-1];\n            });\n        mod1 = Math.sqrt(mod1); mod2 = Math.sqrt(mod2);\n        if (mod1*mod2 === 0)\n        {\n            return null;\n        }\n        var theta = dot / (mod1*mod2);\n        if (theta < -1)\n        {\n            theta = -1;\n        }\n        if (theta > 1)\n        {\n            theta = 1;\n        }\n        return Math.acos(theta);\n    }\n\n    isParallelTo (vector)\n    {\n        var angle = this.angleFrom(vector);\n        return (angle === null) ? null : (angle <= PRECISION);\n    }\n\n    isAntiparallelTo (vector)\n    {\n        var angle = this.angleFrom(vector);\n        return (angle === null) ? null : (Math.abs(angle - Math.PI) <= PRECISION);\n    }\n\n    isPerpendicularTo (vector)\n    {\n        var dot = this.dot(vector);\n        return (dot === null) ? null : (Math.abs(dot) <= PRECISION);\n    }\n\n    add (vector)\n    {\n        var V = vector.elements || vector;\n        if (this.elements.length !== V.length)\n        {\n            return null;\n        }\n        return this.map(function(x, i) { return x + V[i-1]; });\n    }\n\n    subtract (vector)\n    {\n        var V = vector.elements || vector;\n        if (this.elements.length !== V.length)\n        {\n            return null;\n        }\n        return this.map(function(x, i)\n            {\n                return x - V[i-1];\n            });\n    }\n\n    multiply (k)\n    {\n        return this.map(function(x)\n            {\n                return x*k;\n            });\n    }\n\n    dot (vector)\n    {\n        var V = vector.elements || vector;\n        var i, product = 0, n = this.elements.length;\n        if (n !== V.length)\n        {\n            return null;\n        }\n        while (n--)\n        {\n            product += this.elements[n] * V[n];\n        }\n        return product;\n    }\n\n    cross (vector)\n    {\n        var B = vector.elements || vector;\n        if (this.elements.length !== 3 || B.length !== 3)\n        {\n            return null;\n        }\n        var A = this.elements;\n        return new Vector([\n            (A[1] * B[2]) - (A[2] * B[1]),\n            (A[2] * B[0]) - (A[0] * B[2]),\n            (A[0] * B[1]) - (A[1] * B[0])\n        ]);\n    }\n\n    max ()\n    {\n        var m = 0, i = this.elements.length;\n        while (i--)\n        {\n            if (Math.abs(this.elements[i]) > Math.abs(m))\n            {\n                m = this.elements[i];\n            }\n        }\n        return m;\n    }\n\n    indexOf (x)\n    {\n        var index = null, n = this.elements.length;\n        for (var i = 0; i < n; i++)\n        {\n            if (index === null && this.elements[i] === x)\n            {\n                index = i + 1;\n            }\n        }\n        return index;\n    }\n\n    toDiagonalMatrix ()\n    {\n        return Matrix.Diagonal(this.elements);\n    }\n\n    round ()\n    {\n        return this.map(function(x)\n            {\n                return Math.round(x);\n            });\n    }\n\n    snapTo (x)\n    {\n        return this.map(function(y)\n            {\n                return (Math.abs(y - x) <= PRECISION) ? x : y;\n            });\n    }\n\n    distanceFrom (obj)\n    {\n        if (obj.anchor || (obj.start && obj.end))\n        {\n            return obj.distanceFrom(this);\n        }\n        var V = obj.elements || obj;\n        if (V.length !== this.elements.length)\n        {\n            return null;\n        }\n        var sum = 0, part;\n        this.each(function(x, i)\n            {\n                part = x - V[i-1];\n                sum += part * part;\n            });\n        return Math.sqrt(sum);\n    }\n\n    liesOn (line)\n    {\n        return line.contains(this);\n    }\n\n    liesIn (plane)\n    {\n        return plane.contains(this);\n    }\n\n    rotate (t, obj)\n    {\n        var V, R = null, x, y, z;\n        if (t.determinant)\n        {\n            R = t.elements;\n        }\n        switch (this.elements.length)\n        {\n            case 2:\n            {\n                V = obj.elements || obj;\n                if (V.length !== 2)\n                {\n                    return null;\n                }\n                if (!R)\n                {\n                    R = Matrix.Rotation(t).elements;\n                }\n                x = this.elements[0] - V[0];\n                y = this.elements[1] - V[1];\n                return new Vector([\n                    V[0] + R[0][0] * x + R[0][1] * y,\n                    V[1] + R[1][0] * x + R[1][1] * y\n                ]);\n                break;\n            }\n            case 3:\n            {\n                if (!obj.direction)\n                {\n                    return null;\n                }\n                var C = obj.pointClosestTo(this).elements;\n                if (!R)\n                {\n                    R = Matrix.Rotation(t, obj.direction).elements;\n                }\n                x = this.elements[0] - C[0];\n                y = this.elements[1] - C[1];\n                z = this.elements[2] - C[2];\n                return new Vector([\n                    C[0] + R[0][0] * x + R[0][1] * y + R[0][2] * z,\n                    C[1] + R[1][0] * x + R[1][1] * y + R[1][2] * z,\n                    C[2] + R[2][0] * x + R[2][1] * y + R[2][2] * z\n                ]);\n                break;\n            }\n            default:\n            {\n                return null;\n            }\n        }\n    }\n\n    reflectionIn (obj)\n    {\n        if (obj.anchor)\n        {\n            // obj is a plane or line\n            var P = this.elements.slice();\n            var C = obj.pointClosestTo(P).elements;\n            return new Vector([C[0] + (C[0] - P[0]), C[1] + (C[1] - P[1]), C[2] + (C[2] - (P[2] || 0))]);\n        }\n        else\n        {\n            // obj is a point\n            var Q = obj.elements || obj;\n            if (this.elements.length !== Q.length)\n            {\n                return null;\n            }\n            return this.map(function(x, i) { return Q[i-1] + (Q[i-1] - x); });\n        }\n    }\n\n    to3D ()\n    {\n        var V = this.dup();\n        switch (V.elements.length)\n        {\n            case 3:\n            {\n                break;\n            }\n            case 2:\n            {\n                V.elements.push(0);\n                break;\n            }\n            default:\n            {\n                return null;\n            }\n        }\n        return V;\n    }\n\n    inspect ()\n    {\n        return '[' + this.elements.join(', ') + ']';\n    }\n\n    setElements (els)\n    {\n        this.elements = (els.elements || els).slice();\n        return this;\n    }\n\n    //From glUtils.js\n    flatten ()\n    {\n        return this.elements;\n    }\n}\n\nVector.Random = function(n)\n{\n    var elements = [];\n    while (n--)\n    {\n        elements.push(Math.random());\n    }\n    return new Vector(elements);\n};\n\nVector.Zero = function(n)\n{\n    var elements = [];\n    while (n--)\n    {\n        elements.push(0);\n    }\n    return new Vector(elements);\n};\n\nVector.prototype.x = Vector.prototype.multiply;\nVector.prototype.each = Vector.prototype.forEach;\n\nVector.i = new Vector([1,0,0]);\nVector.j = new Vector([0,1,0]);\nVector.k = new Vector([0,0,1]);"]}